name: Test hola_mundo.js y alerta en fallo

on:
  push:
    branches:
      - main

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout código
        uses: actions/checkout@v4

      - name: Configurar Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Verificar archivos
        run: |
          echo "Archivos en el directorio:"
          ls -la
          echo "Contenido de hola_mundo.js:"
          cat hola_mundo.js || echo "hola_mundo.js no encontrado"
          echo "Contenido de test.js:"
          cat test.js || echo "test.js no encontrado"

      - name: Ejecutar test
        run: node test.js

      - name: Notificar fallo en ntfy
        if: failure()
        run: |
          curl -X POST https://ntfy.sh/devops-itla \
            -H "Title: ❌ Test fallido en GitHub Actions" \
            -H "Priority: high" \
            -H "Tags: warning,fire" \
            -d "Repositorio: ${{ github.repository }}
                Rama: ${{ github.ref_name }}
                Commit: ${{ github.sha }}
                Autor: ${{ github.actor }}
                Ejecución: ${{ github.run_id }}
                Trabajo: test
                
                El test de hola_mundo.js falló. Revisa los logs de GitHub Actions."